<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²°ê³¼ í˜ì´ì§€ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Malgun Gothic', sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f0;
        }
        .test-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }
        h2 {
            margin-bottom: 20px;
            color: #2c2c2c;
        }
        button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            opacity: 0.9;
        }
        .info {
            background: #f0f0ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            color: #555;
            line-height: 1.6;
        }
        code {
            background: #e8e8e8;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <div class="test-section">
        <h2>ğŸ“Š ê¸°ì  ê²°ê³¼ í˜ì´ì§€ í…ŒìŠ¤íŠ¸</h2>

        <p><strong>í…ŒìŠ¤íŠ¸ ë°©ë²•:</strong></p>
        <ol>
            <li>ë¨¼ì € ëŒ€í™”ë¥¼ ìƒì„±í•˜ê³  conversationIdë¥¼ ë°›ìœ¼ì„¸ìš”</li>
            <li>ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ conversationIdë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
            <li>ê²°ê³¼ í˜ì´ì§€ë¡œ ì´ë™í•´ì„œ í™•ì¸í•˜ì„¸ìš”</li>
        </ol>

        <button onclick="createTestConversation()">1. í…ŒìŠ¤íŠ¸ ëŒ€í™” ìƒì„±</button>
        <button onclick="viewResult()">2. ê²°ê³¼ í˜ì´ì§€ ë³´ê¸°</button>
        <button onclick="createAndView()">3. ìƒì„± + ê²°ê³¼ ë³´ê¸° (í•œë²ˆì—)</button>

        <div class="info" id="info" style="display: none;"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ”§ ìˆ˜ë™ í…ŒìŠ¤íŠ¸</h2>
        <p>ì§ì ‘ conversationIdë¥¼ ì…ë ¥í•˜ì—¬ í…ŒìŠ¤íŠ¸:</p>
        <input type="text" id="manualId" placeholder="conversationId ì…ë ¥"
               style="width: 100%; padding: 10px; border: 2px solid #e8e8e8; border-radius: 8px; margin-bottom: 10px;">
        <button onclick="viewManualResult()">ê²°ê³¼ ë³´ê¸°</button>

        <div class="info" style="display: block; margin-top: 20px;">
            <strong>API ì—”ë“œí¬ì¸íŠ¸:</strong><br>
            <code>POST /api/select-mode</code> - ëŒ€í™” ì‹œì‘<br>
            <code>POST /api/conversation/answer</code> - ë‹µë³€ ì œì¶œ<br>
            <code>POST /api/miracle/calculate</code> - ê²°ê³¼ ê³„ì‚°<br><br>

            <strong>ê²°ê³¼ í˜ì´ì§€ URL:</strong><br>
            <code>/result.html?id={conversationId}</code>
        </div>
    </div>

    <script>
    const API_URL = 'http://localhost:3000';
    let currentConversationId = null;

    // í…ŒìŠ¤íŠ¸ ëŒ€í™” ìƒì„±
    async function createTestConversation() {
        const info = document.getElementById('info');
        info.style.display = 'block';
        info.innerHTML = 'â³ í…ŒìŠ¤íŠ¸ ëŒ€í™” ìƒì„± ì¤‘...';

        try {
            // 1. ëª¨ë“œ ì„ íƒ (wish ëª¨ë“œ)
            const selectResponse = await fetch(`${API_URL}/api/select-mode`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ mode: 'wish' })
            });
            const selectResult = await selectResponse.json();
            currentConversationId = selectResult.data.conversationId;

            // 2. 3ê°œ ë‹µë³€ ì œì¶œ
            const answers = [
                'ì§ì¥ì—ì„œ ì¸ì •ë°›ê³  ì‹¶ì–´ìš”',
                'íŒ€ì›ë“¤ì´ ì œ ì˜ê²¬ì„ ì¡´ì¤‘í•˜ê³  ë¦¬ë”ë¡œ ì¸ì •ë°›ëŠ” ëª¨ìŠµì´ì—ìš”',
                'ë§¤ì¼ ì•„ì¹¨ ê¸ì •ì ì¸ ë§ˆì¸ë“œë¡œ ì¶œê·¼í•˜ê³  ì ê·¹ì ìœ¼ë¡œ ì˜ê²¬ì„ ì œì‹œí•˜ê² ìŠµë‹ˆë‹¤'
            ];

            for (let i = 0; i < answers.length; i++) {
                await fetch(`${API_URL}/api/conversation/answer`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        conversationId: currentConversationId,
                        answer: answers[i],
                        step: i + 1
                    })
                });
            }

            info.innerHTML = `
                âœ… í…ŒìŠ¤íŠ¸ ëŒ€í™” ìƒì„± ì™„ë£Œ!<br><br>
                <strong>ConversationId:</strong><br>
                <code>${currentConversationId}</code><br><br>
                ì´ì œ "2. ê²°ê³¼ í˜ì´ì§€ ë³´ê¸°" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”!
            `;
        } catch (error) {
            info.innerHTML = `âŒ ì˜¤ë¥˜: ${error.message}`;
        }
    }

    // ê²°ê³¼ í˜ì´ì§€ ë³´ê¸°
    function viewResult() {
        if (!currentConversationId) {
            alert('ë¨¼ì € "1. í…ŒìŠ¤íŠ¸ ëŒ€í™” ìƒì„±" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”!');
            return;
        }
        window.location.href = `/result.html?id=${currentConversationId}`;
    }

    // ìƒì„± + ê²°ê³¼ ë³´ê¸° (í•œë²ˆì—)
    async function createAndView() {
        const info = document.getElementById('info');
        info.style.display = 'block';
        info.innerHTML = 'â³ í…ŒìŠ¤íŠ¸ ëŒ€í™” ìƒì„± ë° ê²°ê³¼ í˜ì´ì§€ë¡œ ì´ë™ ì¤‘...';

        try {
            // 1. ëª¨ë“œ ì„ íƒ
            const selectResponse = await fetch(`${API_URL}/api/select-mode`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ mode: 'wish' })
            });
            const selectResult = await selectResponse.json();
            const convId = selectResult.data.conversationId;

            // 2. 3ê°œ ë‹µë³€ ì œì¶œ
            const answers = [
                'ê±´ê°•í•˜ê³  í–‰ë³µí•œ ì‚¶ì„ ì‚´ê³  ì‹¶ì–´ìš”',
                'ë§¤ì¼ ì•„ì¹¨ í™œë ¥ì´ ë„˜ì¹˜ê³  ì‚¬ë‘í•˜ëŠ” ì‚¬ëŒë“¤ê³¼ ì¦ê±°ìš´ ì‹œê°„ì„ ë³´ë‚´ëŠ” ëª¨ìŠµì´ì—ìš”',
                'ê·œì¹™ì ì¸ ìš´ë™ê³¼ ê±´ê°•í•œ ì‹ìŠµê´€ì„ ì‹¤ì²œí•˜ê² ìŠµë‹ˆë‹¤'
            ];

            for (let i = 0; i < answers.length; i++) {
                await fetch(`${API_URL}/api/conversation/answer`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        conversationId: convId,
                        answer: answers[i],
                        step: i + 1
                    })
                });
            }

            // 3. ê²°ê³¼ í˜ì´ì§€ë¡œ ì´ë™
            window.location.href = `/result.html?id=${convId}`;
        } catch (error) {
            info.innerHTML = `âŒ ì˜¤ë¥˜: ${error.message}`;
        }
    }

    // ìˆ˜ë™ ì…ë ¥ìœ¼ë¡œ ê²°ê³¼ ë³´ê¸°
    function viewManualResult() {
        const manualId = document.getElementById('manualId').value.trim();
        if (!manualId) {
            alert('conversationIdë¥¼ ì…ë ¥í•˜ì„¸ìš”!');
            return;
        }
        window.location.href = `/result.html?id=${manualId}`;
    }
    </script>
</body>
</html>
