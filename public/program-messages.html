<!DOCTYPE html>
<html lang="ko">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FRRJ7JZPGZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-FRRJ7JZPGZ');
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì˜¤ëŠ˜ì˜ ì‘ì› ë©”ì‹œì§€ - í•˜ë£¨í•˜ë£¨ì˜ ê¸°ì </title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
    }

    /* ë¡œë”© ìƒíƒœ */
    .loading {
      background: white;
      border-radius: 20px;
      padding: 60px 40px;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0,0,0,0.2);
    }
    .loading-spinner {
      width: 48px;
      height: 48px;
      border: 4px solid #e0e0e0;
      border-top-color: #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* ì—ëŸ¬ ìƒíƒœ */
    .error-card {
      background: white;
      border-radius: 20px;
      padding: 40px;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0,0,0,0.2);
    }
    .error-icon { font-size: 64px; margin-bottom: 20px; }
    .error-title { font-size: 20px; color: #333; margin-bottom: 12px; }
    .error-message { font-size: 14px; color: #666; margin-bottom: 24px; }
    .error-btn {
      display: inline-block;
      padding: 12px 24px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      text-decoration: none;
      border-radius: 10px;
      font-weight: 600;
    }

    /* ë©”ì¸ ì»¨í…ì¸  */
    .main-content { display: none; }
    .main-content.show { display: block; }

    /* í—¤ë” */
    .header {
      text-align: center;
      color: white;
      margin-bottom: 24px;
    }
    .header-badge {
      display: inline-block;
      background: rgba(255,255,255,0.2);
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      margin-bottom: 12px;
    }
    .header h1 {
      font-size: 24px;
      margin-bottom: 8px;
    }
    .header p {
      font-size: 14px;
      opacity: 0.9;
    }

    /* ë©”ì‹œì§€ ì¹´ë“œ */
    .message-card {
      background: white;
      border-radius: 20px;
      padding: 32px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.2);
      margin-bottom: 20px;
      position: relative;
      overflow: hidden;
    }
    .message-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 6px;
      background: linear-gradient(90deg, #667eea, #764ba2);
    }

    /* ë‚ ì§œ & ì‹œê°„ëŒ€ */
    .day-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    .day-badge {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      padding: 10px 20px;
      border-radius: 20px;
      font-weight: 700;
      font-size: 16px;
    }
    .time-toggle {
      display: flex;
      gap: 8px;
    }
    .time-btn {
      padding: 8px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 20px;
      background: white;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .time-btn.active {
      border-color: #667eea;
      background: #f8f9ff;
      color: #667eea;
      font-weight: 600;
    }

    /* ë©”ì‹œì§€ ë‚´ìš© */
    .message-icon {
      font-size: 56px;
      text-align: center;
      margin-bottom: 20px;
    }
    .message-title {
      font-size: 22px;
      font-weight: 700;
      color: #333;
      text-align: center;
      margin-bottom: 16px;
      line-height: 1.4;
    }
    .message-text {
      font-size: 16px;
      color: #555;
      line-height: 1.8;
      text-align: center;
      margin-bottom: 24px;
    }
    .message-quote {
      background: linear-gradient(135deg, #f8f9ff, #fff5f7);
      padding: 20px;
      border-radius: 12px;
      border-left: 4px solid #667eea;
      font-style: italic;
      color: #667eea;
      font-size: 15px;
      line-height: 1.6;
    }

    /* ì§„í–‰ë¥  ì¹´ë“œ */
    .progress-card {
      background: white;
      border-radius: 20px;
      padding: 24px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.15);
      margin-bottom: 20px;
    }
    .progress-title {
      font-size: 16px;
      font-weight: 600;
      color: #333;
      text-align: center;
      margin-bottom: 16px;
    }
    .progress-bar-wrap {
      height: 12px;
      background: #e5e7eb;
      border-radius: 6px;
      overflow: hidden;
      margin-bottom: 12px;
    }
    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea, #764ba2);
      transition: width 0.5s ease;
      border-radius: 6px;
    }
    .progress-info {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      color: #666;
    }
    .progress-percent {
      color: #667eea;
      font-weight: 600;
    }

    /* ë‚ ì§œ ê·¸ë¦¬ë“œ */
    .days-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
      margin-top: 16px;
    }
    .day-dot {
      aspect-ratio: 1;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 600;
      border: 2px solid #e5e7eb;
      color: #9ca3af;
      cursor: pointer;
      transition: all 0.2s;
    }
    .day-dot.completed {
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-color: #667eea;
      color: white;
    }
    .day-dot.current {
      border-color: #667eea;
      color: #667eea;
      animation: pulse 2s infinite;
    }
    .day-dot.future {
      opacity: 0.5;
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    /* ì•¡ì…˜ ë²„íŠ¼ */
    .action-buttons {
      display: flex;
      gap: 12px;
    }
    .btn {
      flex: 1;
      padding: 14px;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.2s;
    }
    .btn-primary {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102,126,234,0.4);
    }
    .btn-secondary {
      background: white;
      color: #667eea;
      border: 2px solid #667eea;
    }
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* ì—…ê·¸ë ˆì´ë“œ ì•ˆë‚´ ë°•ìŠ¤ */
    .upgrade-box {
      display: none;
      background: linear-gradient(135deg, #fff9e6, #fff3cd);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
      border: 2px solid #ffc107;
      text-align: center;
    }
    .upgrade-box.show {
      display: block;
      animation: slideIn 0.5s ease;
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .upgrade-title {
      font-size: 20px;
      font-weight: 700;
      color: #333;
      margin-bottom: 12px;
    }
    .upgrade-text {
      font-size: 15px;
      color: #555;
      line-height: 1.6;
      margin-bottom: 16px;
    }
    .upgrade-credit {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      padding: 10px 16px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 16px;
      display: inline-block;
    }
    .upgrade-btn {
      display: inline-block;
      padding: 14px 32px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      text-decoration: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 700;
      transition: all 0.2s;
    }
    .upgrade-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102,126,234,0.4);
    }
    .upgrade-later {
      display: block;
      margin-top: 12px;
      font-size: 13px;
      color: #888;
      cursor: pointer;
    }
    .upgrade-later:hover {
      color: #667eea;
    }

    /* í‘¸í„° */
    .footer {
      text-align: center;
      padding: 20px;
      color: rgba(255,255,255,0.7);
      font-size: 13px;
    }
    .footer a { color: rgba(255,255,255,0.9); }

    /* ë°˜ì‘í˜• */
    @media (max-width: 480px) {
      .message-card { padding: 24px; }
      .message-title { font-size: 18px; }
      .message-text { font-size: 14px; }
      .day-header { flex-direction: column; gap: 12px; }
      .days-grid { grid-template-columns: repeat(7, 1fr); gap: 6px; }
      .day-dot { font-size: 10px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ë¡œë”© ìƒíƒœ -->
    <div class="loading" id="loading">
      <div class="loading-spinner"></div>
      <p>ë©”ì‹œì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
    </div>

    <!-- ì—ëŸ¬ ìƒíƒœ -->
    <div class="error-card" id="error" style="display: none;">
      <div class="error-icon">ğŸ˜¢</div>
      <h2 class="error-title">ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤</h2>
      <p class="error-message" id="error-message">í”„ë¡œê·¸ë¨ì„ êµ¬ë§¤í•˜ì‹œë©´ ë§¤ì¼ ë§ì¶¤ ì‘ì› ë©”ì‹œì§€ë¥¼ ë°›ìœ¼ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
      <a href="/program" class="error-btn">í”„ë¡œê·¸ë¨ êµ¬ë§¤í•˜ê¸°</a>
    </div>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <div class="main-content" id="main-content">
      <!-- í—¤ë” -->
      <div class="header">
        <div class="header-badge" id="program-badge">30ì¼ í”„ë¡œê·¸ë¨</div>
        <h1>ì˜¤ëŠ˜ì˜ ì‘ì› ë©”ì‹œì§€</h1>
        <p id="user-info">í•˜ë£¨í•˜ë£¨ì˜ ê¸°ì ê³¼ í•¨ê»˜í•©ë‹ˆë‹¤</p>
      </div>

      <!-- ë©”ì‹œì§€ ì¹´ë“œ -->
      <div class="message-card">
        <div class="day-header">
          <div class="day-badge" id="day-badge">Day 1</div>
          <div class="time-toggle">
            <button class="time-btn active" id="btn-morning" onclick="showMessage('morning')">ì•„ì¹¨</button>
            <button class="time-btn" id="btn-evening" onclick="showMessage('evening')">ì €ë…</button>
          </div>
        </div>

        <div class="message-icon" id="message-icon">âœ¨</div>
        <h2 class="message-title" id="message-title">ì˜¤ëŠ˜ í•˜ë£¨ë„ í˜ë‚´ì„¸ìš”!</h2>
        <p class="message-text" id="message-text">ë‹¹ì‹ ì˜ ì†Œì›ì´ ì´ë£¨ì–´ì§€ëŠ” ê·¸ ë‚ ê¹Œì§€, í•˜ë£¨í•˜ë£¨ì˜ ê¸°ì ì´ í•¨ê»˜í•©ë‹ˆë‹¤.</p>
        <div class="message-quote" id="message-quote">"ì‘ì€ í•œ ê±¸ìŒì´ í° ë³€í™”ë¥¼ ë§Œë“­ë‹ˆë‹¤"</div>
      </div>

      <!-- ì§„í–‰ë¥  ì¹´ë“œ -->
      <div class="progress-card">
        <div class="progress-title" id="progress-title">30ì¼ ì—¬ì •</div>
        <div class="progress-bar-wrap">
          <div class="progress-bar-fill" id="progress-bar" style="width: 0%;"></div>
        </div>
        <div class="progress-info">
          <span id="progress-days">1/30ì¼</span>
          <span class="progress-percent" id="progress-percent">3%</span>
        </div>
        <div class="days-grid" id="days-grid"></div>
      </div>

      <!-- ì—…ê·¸ë ˆì´ë“œ ì•ˆë‚´ ë°•ìŠ¤ (7ì¼ ì™„ì£¼ ì‹œ) -->
      <div class="upgrade-box" id="upgrade-box">
        <div class="upgrade-title">ğŸ‰ ì™„ì£¼ ì¶•í•˜í•´ìš”! ë‹¤ìŒ ë‹¨ê³„</div>
        <p class="upgrade-text">
          7ì¼ ë™ì•ˆ ì •ë§ ì˜ í•´ëƒˆì–´ìš”.<br>
          ì´ì œ 'ì˜ì§€'ê°€ ì•„ë‹ˆë¼ 'ì‹œìŠ¤í…œ'ìœ¼ë¡œ ê°€ìš”.<br>
          30ì¼ í”„ë¡œê·¸ë¨ìœ¼ë¡œ ì†Œì›ì„ 'í˜„ì‹¤'ë¡œ ë°”ê¿”ë³¼ê¹Œìš”?
        </p>
        <div class="upgrade-credit" id="upgrade-credit-notice">
          24ì‹œê°„ ë‚´ ì—…ê·¸ë ˆì´ë“œ ì‹œ ì „ì•¡ í¬ë ˆë”§!
        </div>
        <a href="/program" class="upgrade-btn">30ì¼ë¡œ ì´ì–´ê°€ê¸° â†’</a>
        <span class="upgrade-later" onclick="hideUpgradeBox()">ë‚˜ì¤‘ì— í• ê²Œìš”</span>
      </div>

      <!-- ì•¡ì…˜ ë²„íŠ¼ -->
      <div class="action-buttons">
        <button class="btn btn-secondary" id="btn-prev" onclick="changeDay(-1)" disabled>ì´ì „</button>
        <button class="btn btn-primary" id="btn-next" onclick="changeDay(1)">ë‹¤ìŒ ë‚ </button>
      </div>
    </div>

    <div class="footer">
      <p>í•˜ë£¨í•˜ë£¨ì˜ ê¸°ì  | <a href="/">í™ˆìœ¼ë¡œ</a></p>
    </div>
  </div>

  <script>
    // ìƒíƒœ ë³€ìˆ˜
    let token = null;
    let userData = null;
    let currentDay = 1;
    let totalDays = 30;
    let currentTime = 'morning';
    let messagesData = [];
    let is7DayProgram = false;
    let activeEntitlement = 'trial';

    // í”„ë¡œê·¸ë¨ë³„ ì„¤ì •
    const PROGRAM_CONFIG = {
      'trial': { days: 7, name: '7ì¼ ì²´í—˜', icon: 'ğŸŒ±' },
      'starter_7': { days: 7, name: 'ìŠ¤íƒ€í„° 7', icon: 'â­' },
      'wish_30': { days: 30, name: 'ì†Œì›ì‹¤í˜„ 30', icon: 'âœ¨' },
      'solve_30': { days: 30, name: 'ë¬¸ì œí•´ê²° 30', icon: 'ğŸ”§' },
      'dual_30': { days: 30, name: 'ë“€ì–¼ 30', icon: 'ğŸŒŸ' }
    };

    // ìƒ˜í”Œ ë©”ì‹œì§€ (APIê°€ ìƒ˜í”Œ ë°˜í™˜ ì‹œ ì‚¬ìš©)
    const SAMPLE_MESSAGES = generateSampleMessages(30);

    function generateSampleMessages(days) {
      const morningIcons = ['ğŸŒ…', 'â˜€ï¸', 'ğŸŒ¤ï¸', 'ğŸŒˆ', 'âœ¨', 'ğŸ’«', 'ğŸŒŸ', 'â­', 'ğŸ¯', 'ğŸ’ª'];
      const eveningIcons = ['ğŸŒ™', 'ğŸŒƒ', 'ğŸŒ ', 'ğŸ’œ', 'ğŸŒ¸', 'ğŸ€', 'ğŸ', 'ğŸ’', 'ğŸ†', 'ğŸ‰'];
      const morningTitles = [
        'ìƒˆë¡œìš´ í•˜ë£¨ê°€ ì‹œì‘ë©ë‹ˆë‹¤', 'ì˜¤ëŠ˜ë„ ë¹›ë‚˜ëŠ” í•˜ë£¨ ë˜ì„¸ìš”', 'ë‹¹ì‹ ì˜ í•˜ë£¨ë¥¼ ì‘ì›í•©ë‹ˆë‹¤',
        'ì¢‹ì€ ì¼ì´ ê°€ë“í•  ê±°ì˜ˆìš”', 'ì˜¤ëŠ˜ì€ íŠ¹ë³„í•œ ë‚ ì…ë‹ˆë‹¤', 'í¬ë§ì°¬ ì•„ì¹¨ì´ì—ìš”',
        'ê¸°ì ì€ ë§¤ì¼ ì¼ì–´ë‚©ë‹ˆë‹¤', 'ë‹¹ì‹ ì€ í•  ìˆ˜ ìˆì–´ìš”', 'ì˜¤ëŠ˜ë„ í™”ì´íŒ…!', 'í–‰ë³µí•œ í•˜ë£¨ ë³´ë‚´ì„¸ìš”'
      ];
      const eveningTitles = [
        'ì˜¤ëŠ˜ í•˜ë£¨ë„ ìˆ˜ê³ í–ˆì–´ìš”', 'í¸ì•ˆí•œ ë°¤ ë˜ì„¸ìš”', 'ë‹¹ì‹ ì€ ì˜¤ëŠ˜ë„ ìµœì„ ì„ ë‹¤í–ˆì–´ìš”',
        'ë‚´ì¼ì€ ë” ì¢‹ì€ ë‚ ì´ ë  ê±°ì˜ˆìš”', 'í‘¹ ì‰¬ê³  ì¶©ì „í•˜ì„¸ìš”', 'ì˜¤ëŠ˜ì˜ ë…¸ë ¥ì— ë°•ìˆ˜ë¥¼',
        'ë‹¬ì½¤í•œ ê¿ˆê¾¸ì„¸ìš”', 'ë‹¹ì‹ ì˜ í•˜ë£¨ê°€ ìë‘ìŠ¤ëŸ¬ì›Œìš”', 'ì˜ í•´ëƒˆì–´ìš”!', 'êµ¿ë‚˜ì‡!'
      ];

      const messages = [];
      for (let i = 1; i <= days; i++) {
        messages.push({
          day: i,
          morning: {
            icon: morningIcons[(i - 1) % morningIcons.length],
            title: morningTitles[(i - 1) % morningTitles.length],
            text: `Day ${i}ì˜ ì•„ì¹¨ì…ë‹ˆë‹¤. ì˜¤ëŠ˜ í•˜ë£¨ë„ ë‹¹ì‹ ì˜ ì†Œì›ì´ í•œ ê±¸ìŒ ë” ê°€ê¹Œì›Œì§€ëŠ” ë‚ ì´ ë  ê±°ì˜ˆìš”. ì‘ì€ ì‹¤ì²œ í•˜ë‚˜ê°€ í° ë³€í™”ë¥¼ ë§Œë“­ë‹ˆë‹¤.`,
            quote: '"ì˜¤ëŠ˜ì˜ ì‘ì€ í•œ ê±¸ìŒì´ ë‚´ì¼ì˜ í° ë„ì•½ì´ ë©ë‹ˆë‹¤"'
          },
          evening: {
            icon: eveningIcons[(i - 1) % eveningIcons.length],
            title: eveningTitles[(i - 1) % eveningTitles.length],
            text: `Day ${i}ì˜ ì €ë…ì…ë‹ˆë‹¤. ì˜¤ëŠ˜ í•˜ë£¨ë„ ì •ë§ ìˆ˜ê³  ë§ì•˜ì–´ìš”. ë‹¹ì‹ ì˜ ë…¸ë ¥ì€ ë¶„ëª… ê²°ì‹¤ì„ ë§ºì„ ê±°ì˜ˆìš”. í¸ì•ˆí•œ ë°¤ ë³´ë‚´ì„¸ìš”.`,
            quote: '"ì˜¤ëŠ˜ì˜ ìˆ˜ê³ ê°€ ë‚´ì¼ì˜ ê¸°ì ì„ ë§Œë“­ë‹ˆë‹¤"'
          }
        });
      }
      return messages;
    }

    // í˜ì´ì§€ ë¡œë“œ
    window.addEventListener('load', async () => {
      const params = new URLSearchParams(window.location.search);
      token = params.get('token');

      if (!token) {
        showError('í† í°ì´ ì—†ìŠµë‹ˆë‹¤. í”„ë¡œê·¸ë¨ êµ¬ë§¤ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
        return;
      }

      try {
        const response = await fetch(`/api/daily-messages?token=${token}`);
        const data = await response.json();

        if (!data.success) {
          showError(data.message || 'ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }

        userData = data.user;
        messagesData = data.messages && data.messages.length > 0 ? data.messages : SAMPLE_MESSAGES;

        // ê¶Œí•œì— ë”°ë¥¸ ì„¤ì •
        setupProgram(data.entitlements || [userData.type]);

        // ì €ì¥ëœ ì§„í–‰ìƒí™© ë¶ˆëŸ¬ì˜¤ê¸°
        loadProgress();

        // UI í‘œì‹œ
        showMainContent();
        renderDay();
        renderProgress();

      } catch (error) {
        console.error('Error:', error);
        showError('ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
      }
    });

    function setupProgram(entitlements) {
      // ê°€ì¥ ë†’ì€ ë“±ê¸‰ì˜ ê¶Œí•œ ì°¾ê¸°
      const priority = ['dual_30', 'wish_30', 'solve_30', 'starter_7', 'trial'];

      for (const ent of priority) {
        if (entitlements.includes(ent)) {
          activeEntitlement = ent;
          break;
        }
      }

      const config = PROGRAM_CONFIG[activeEntitlement] || PROGRAM_CONFIG['trial'];
      totalDays = config.days;

      // 7ì¼ í”„ë¡œê·¸ë¨ì¸ì§€ í™•ì¸ (trial ë˜ëŠ” starter_7)
      is7DayProgram = (activeEntitlement === 'trial' || activeEntitlement === 'starter_7');

      document.getElementById('program-badge').textContent = config.name;
      document.getElementById('progress-title').textContent = `${config.days}ì¼ ì—¬ì •`;

      // ìŠ¤íƒ€í„° 7ì€ í¬ë ˆë”§ ì•ˆë‚´ í‘œì‹œ
      if (activeEntitlement === 'starter_7') {
        document.getElementById('upgrade-credit-notice').textContent = '24ì‹œê°„ ë‚´ ì—…ê·¸ë ˆì´ë“œ ì‹œ 9,900ì› ì „ì•¡ í¬ë ˆë”§!';
      } else if (activeEntitlement === 'trial') {
        document.getElementById('upgrade-credit-notice').style.display = 'none';
      }

      // ë©”ì‹œì§€ ë°ì´í„° ê¸¸ì´ ì¡°ì •
      if (messagesData.length < totalDays) {
        messagesData = generateSampleMessages(totalDays);
      }
    }

    function showError(message) {
      document.getElementById('loading').style.display = 'none';
      document.getElementById('error').style.display = 'block';
      document.getElementById('error-message').textContent = message;
    }

    function showMainContent() {
      document.getElementById('loading').style.display = 'none';
      document.getElementById('main-content').classList.add('show');
    }

    function loadProgress() {
      const saved = localStorage.getItem(`program_progress_${token.substring(0, 16)}`);
      if (saved) {
        const data = JSON.parse(saved);
        currentDay = Math.min(data.currentDay || 1, totalDays);
      }
    }

    function saveProgress() {
      localStorage.setItem(`program_progress_${token.substring(0, 16)}`, JSON.stringify({
        currentDay,
        lastUpdated: new Date().toISOString()
      }));
    }

    function renderDay() {
      const msg = messagesData[currentDay - 1];
      if (!msg) return;

      const timeData = currentTime === 'morning' ? msg.morning : msg.evening;

      document.getElementById('day-badge').textContent = `Day ${currentDay}`;
      document.getElementById('message-icon').textContent = timeData.icon;
      document.getElementById('message-title').textContent = timeData.title;
      document.getElementById('message-text').textContent = timeData.text;
      document.getElementById('message-quote').textContent = timeData.quote;

      // ë²„íŠ¼ ìƒíƒœ
      document.getElementById('btn-prev').disabled = currentDay <= 1;
      document.getElementById('btn-next').disabled = currentDay >= totalDays;
      document.getElementById('btn-next').textContent = currentDay >= totalDays ? 'ì™„ë£Œ!' : 'ë‹¤ìŒ ë‚ ';

      // 7ì¼ í”„ë¡œê·¸ë¨ ë§ˆì§€ë§‰ ë‚ ì— ì—…ê·¸ë ˆì´ë“œ ì•ˆë‚´ í‘œì‹œ
      checkUpgradeBox();
    }

    function checkUpgradeBox() {
      const upgradeBox = document.getElementById('upgrade-box');
      const dismissed = localStorage.getItem(`upgrade_dismissed_${token ? token.substring(0, 16) : ''}`);

      // 7ì¼ í”„ë¡œê·¸ë¨ì´ê³ , ë§ˆì§€ë§‰ ë‚ ì´ê³ , ì•„ì§ dismissí•˜ì§€ ì•Šì•˜ìœ¼ë©´ í‘œì‹œ
      if (is7DayProgram && currentDay >= totalDays && !dismissed) {
        upgradeBox.classList.add('show');
      } else {
        upgradeBox.classList.remove('show');
      }
    }

    function hideUpgradeBox() {
      const upgradeBox = document.getElementById('upgrade-box');
      upgradeBox.classList.remove('show');
      // ì´ë²ˆ ì„¸ì…˜ì—ì„œë§Œ ìˆ¨ê¹€ (localStorageì— ì €ì¥í•˜ë©´ ì˜êµ¬ ìˆ¨ê¹€)
      if (token) {
        localStorage.setItem(`upgrade_dismissed_${token.substring(0, 16)}`, 'true');
      }
    }

    function renderProgress() {
      const percent = Math.round((currentDay / totalDays) * 100);

      document.getElementById('progress-bar').style.width = `${percent}%`;
      document.getElementById('progress-days').textContent = `${currentDay}/${totalDays}ì¼`;
      document.getElementById('progress-percent').textContent = `${percent}%`;

      // ë‚ ì§œ ê·¸ë¦¬ë“œ
      const grid = document.getElementById('days-grid');
      grid.innerHTML = '';

      for (let i = 1; i <= totalDays; i++) {
        const dot = document.createElement('div');
        dot.className = 'day-dot';
        dot.textContent = i;

        if (i < currentDay) {
          dot.classList.add('completed');
        } else if (i === currentDay) {
          dot.classList.add('current');
        } else {
          dot.classList.add('future');
        }

        dot.onclick = () => goToDay(i);
        grid.appendChild(dot);
      }
    }

    function showMessage(time) {
      currentTime = time;

      document.getElementById('btn-morning').classList.toggle('active', time === 'morning');
      document.getElementById('btn-evening').classList.toggle('active', time === 'evening');

      renderDay();
    }

    function changeDay(delta) {
      const newDay = currentDay + delta;
      if (newDay >= 1 && newDay <= totalDays) {
        currentDay = newDay;
        saveProgress();
        renderDay();
        renderProgress();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    }

    function goToDay(day) {
      if (day >= 1 && day <= currentDay) {
        currentDay = day;
        renderDay();
        renderProgress();
      }
    }
  </script>
</body>
</html>
