<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>당신의 기적 지수 - 하루하루의 기적</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* 히어로 섹션 - 기적지수 대시보드 */
        .hero-section {
            background: white;
            border-radius: 24px;
            padding: 60px 40px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 200px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            z-index: 0;
        }

        .hero-content {
            position: relative;
            z-index: 1;
        }

        .user-greeting {
            font-size: 32px;
            font-weight: 700;
            color: #333;
            margin-bottom: 16px;
        }

        .user-greeting .name {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .miracle-index-display {
            margin: 40px 0;
        }

        .index-circle {
            width: 220px;
            height: 220px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.4);
            animation: pulse 2s infinite;
            position: relative;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        .index-circle::after {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 3px solid rgba(255, 255, 255, 0.3);
        }

        .index-number {
            font-size: 72px;
            font-weight: 800;
            color: white;
            line-height: 1;
            position: relative;
            z-index: 1;
        }

        .index-label {
            font-size: 18px;
            color: rgba(255, 255, 255, 0.9);
            margin-top: 8px;
            position: relative;
            z-index: 1;
        }

        .index-description {
            font-size: 20px;
            color: #666;
            line-height: 1.6;
            max-width: 600px;
            margin: 0 auto;
        }

        /* 5가지 운명 예측 */
        .destiny-section {
            background: white;
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .section-title {
            font-size: 28px;
            font-weight: 700;
            color: #333;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-icon {
            font-size: 36px;
        }

        .destiny-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .destiny-card {
            background: linear-gradient(135deg, #f8f9ff 0%, #fff5f7 100%);
            border-radius: 16px;
            padding: 24px;
            border-left: 5px solid #667eea;
            transition: all 0.3s ease;
        }

        .destiny-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .destiny-card .icon {
            font-size: 32px;
            margin-bottom: 12px;
        }

        .destiny-card h3 {
            font-size: 20px;
            color: #667eea;
            margin-bottom: 12px;
        }

        .destiny-card p {
            color: #666;
            line-height: 1.6;
            font-size: 15px;
        }

        /* 30일 로드맵 */
        .roadmap-section {
            background: white;
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .timeline {
            position: relative;
            padding-left: 40px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(to bottom, #667eea, #764ba2);
        }

        .timeline-week {
            position: relative;
            margin-bottom: 32px;
        }

        .timeline-week::before {
            content: '';
            position: absolute;
            left: -32px;
            top: 8px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            border: 4px solid white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
        }

        .week-number {
            font-size: 14px;
            font-weight: 600;
            color: #667eea;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .week-title {
            font-size: 22px;
            font-weight: 700;
            color: #333;
            margin-bottom: 12px;
        }

        .week-description {
            color: #666;
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .week-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .action-tag {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }

        /* 관계 분석 */
        .relationship-section {
            background: white;
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .relationship-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 24px;
        }

        .person-card {
            background: linear-gradient(135deg, #f8f9ff 0%, #fff5f7 100%);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
        }

        .person-name {
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 8px;
        }

        .person-type {
            font-size: 14px;
            color: #999;
            margin-bottom: 16px;
        }

        .compatibility-bar {
            height: 12px;
            background: #e5e7eb;
            border-radius: 6px;
            overflow: hidden;
            margin: 16px 0;
        }

        .compatibility-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 1s ease;
        }

        /* 액션 버튼 */
        .action-buttons {
            display: flex;
            gap: 16px;
            margin-top: 40px;
            justify-content: center;
        }

        .btn {
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #f8f9ff;
        }

        /* 로딩 상태 */
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: white;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 반응형 */
        @media (max-width: 768px) {
            .hero-section {
                padding: 40px 24px;
            }

            .user-greeting {
                font-size: 24px;
            }

            .index-circle {
                width: 180px;
                height: 180px;
            }

            .index-number {
                font-size: 56px;
            }

            .destiny-grid {
                grid-template-columns: 1fr;
            }

            .relationship-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>당신의 기적을 준비하고 있습니다...</p>
        </div>

        <div id="content" style="display: none;">
            <!-- 히어로 섹션 - 기적지수 -->
            <div class="hero-section">
                <div class="hero-content">
                    <h1 class="user-greeting"><span class="name" id="userName">사용자</span>님의 기적 지수</h1>

                    <div class="miracle-index-display">
                        <div class="index-circle">
                            <div class="index-number" id="miracleIndex">75</div>
                            <div class="index-label">MIRACLE INDEX</div>
                        </div>
                        <p class="index-description" id="indexDescription">
                            당신의 기적은 이미 시작되었습니다. 높은 변화 가능성과 강한 의지가 보입니다.
                        </p>
                    </div>
                </div>
            </div>

            <!-- 5가지 운명 예측 -->
            <div class="destiny-section">
                <h2 class="section-title">
                    <span class="section-icon">🔮</span>
                    5가지 운명 예측
                </h2>
                <div class="destiny-grid" id="destinyGrid">
                    <!-- JavaScript로 동적 생성 -->
                </div>
            </div>

            <!-- 관계 분석 (있을 경우에만) -->
            <div class="relationship-section" id="relationshipSection" style="display: none;">
                <h2 class="section-title">
                    <span class="section-icon">💕</span>
                    관계 분석
                </h2>
                <div class="relationship-grid">
                    <div class="person-card">
                        <div class="person-name" id="user1Name">나</div>
                        <div class="person-type" id="user1Type">성장형</div>
                        <div id="user1Traits"></div>
                    </div>
                    <div class="person-card">
                        <div class="person-name" id="user2Name">상대방</div>
                        <div class="person-type" id="user2Type">안정형</div>
                        <div id="user2Traits"></div>
                    </div>
                </div>
                <div style="margin-top: 24px; text-align: center;">
                    <h3 style="color: #667eea; margin-bottom: 12px;">관계 조화도</h3>
                    <div class="compatibility-bar" style="max-width: 400px; margin: 0 auto;">
                        <div class="compatibility-fill" id="compatibilityFill" style="width: 0%;"></div>
                    </div>
                    <p id="compatibilityScore" style="margin-top: 8px; font-size: 18px; font-weight: 600; color: #667eea;">
                        85점
                    </p>
                </div>
            </div>

            <!-- 30일 로드맵 -->
            <div class="roadmap-section">
                <h2 class="section-title">
                    <span class="section-icon">🗺️</span>
                    30일 기적 로드맵
                </h2>
                <div class="timeline" id="roadmapTimeline">
                    <!-- JavaScript로 동적 생성 -->
                </div>
            </div>

            <!-- 액션 버튼 -->
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="startDailyMessages()">
                    7일 응원 메시지 시작하기
                </button>
                <button class="btn btn-secondary" onclick="shareResult()">
                    결과 공유하기
                </button>
            </div>
        </div>
    </div>

    <script>
        let analysisData = null;

        // 페이지 로드 시 데이터 로드
        window.addEventListener('load', async () => {
            try {
                // localStorage 또는 API에서 최신 분석 결과 가져오기
                const stored = localStorage.getItem('latestAnalysis');
                if (stored) {
                    analysisData = JSON.parse(stored);
                } else {
                    // API에서 최신 결과 가져오기
                    const response = await fetch('/api/story/latest');
                    analysisData = await response.json();
                }

                if (analysisData && analysisData.story) {
                    renderResults(analysisData.story);
                } else {
                    throw new Error('No analysis data found');
                }
            } catch (error) {
                console.error('Error loading analysis:', error);
                document.getElementById('loading').innerHTML = '<p>분석 결과를 불러올 수 없습니다. 다시 시도해주세요.</p>';
            }
        });

        function renderResults(story) {
            const { userProfile, counterpartyProfile, relationshipAnalysis, actionPlan } = story;

            // 기적지수 표시
            document.getElementById('userName').textContent = userProfile.name || '사용자';
            document.getElementById('miracleIndex').textContent = userProfile.miracleIndex || 75;
            document.getElementById('indexDescription').textContent =
                getIndexDescription(userProfile.miracleIndex);

            // 5가지 운명 예측 생성
            renderDestinyPredictions(userProfile);

            // 관계 분석 (있을 경우)
            if (counterpartyProfile && relationshipAnalysis) {
                renderRelationshipAnalysis(userProfile, counterpartyProfile, relationshipAnalysis);
            }

            // 30일 로드맵
            renderRoadmap(actionPlan);

            // 로딩 숨기고 콘텐츠 표시
            document.getElementById('loading').style.display = 'none';
            document.getElementById('content').style.display = 'block';

            // 애니메이션 효과
            animateCompatibilityBar();
        }

        function getIndexDescription(index) {
            if (index >= 80) return '놀라운 가능성이 보입니다! 당신은 이미 변화를 위한 강한 의지와 준비가 되어 있습니다.';
            if (index >= 60) return '긍정적인 변화의 씨앗이 심어져 있습니다. 조금만 더 노력하면 큰 변화를 경험할 수 있습니다.';
            if (index >= 40) return '변화를 위한 기반이 마련되었습니다. 꾸준한 실천이 기적을 만들어낼 것입니다.';
            return '새로운 시작의 단계입니다. 작은 변화부터 시작해보세요.';
        }

        function renderDestinyPredictions(userProfile) {
            const predictions = [
                {
                    icon: '💎',
                    title: '관계의 운명',
                    description: userProfile.insights?.[0] || '소중한 관계들이 더욱 깊어지고 의미있게 발전할 것입니다. 솔직한 대화가 관계를 변화시킬 열쇠가 됩니다.'
                },
                {
                    icon: '🌟',
                    title: '성장의 운명',
                    description: userProfile.insights?.[1] || '내면의 성장과 함께 외적인 성공도 함께 찾아옵니다. 새로운 기회가 당신을 기다리고 있습니다.'
                },
                {
                    icon: '🎯',
                    title: '목표의 운명',
                    description: userProfile.insights?.[2] || '명확한 목표 설정이 성공의 90%입니다. 당신의 목표는 이미 실현 가능성이 높습니다.'
                },
                {
                    icon: '💫',
                    title: '변화의 운명',
                    description: userProfile.insights?.[3] || '큰 변화의 시기가 다가오고 있습니다. 두려워하지 말고 받아들이세요. 긍정적인 변화입니다.'
                },
                {
                    icon: '🌈',
                    title: '행복의 운명',
                    description: userProfile.insights?.[4] || '진정한 행복은 내면에서 시작됩니다. 작은 기쁨들을 소중히 여기면 큰 행복이 찾아옵니다.'
                }
            ];

            const grid = document.getElementById('destinyGrid');
            grid.innerHTML = predictions.map(p => `
                <div class="destiny-card">
                    <div class="icon">${p.icon}</div>
                    <h3>${p.title}</h3>
                    <p>${p.description}</p>
                </div>
            `).join('');
        }

        function renderRelationshipAnalysis(user, counterparty, analysis) {
            const section = document.getElementById('relationshipSection');
            section.style.display = 'block';

            document.getElementById('user1Name').textContent = user.name || '나';
            document.getElementById('user1Type').textContent = user.element || '성장형';
            document.getElementById('user1Traits').innerHTML =
                (user.strengths || ['긍정적', '끈기있는']).map(s =>
                    `<span class="action-tag">${s}</span>`
                ).join('');

            document.getElementById('user2Name').textContent = counterparty.name || '상대방';
            document.getElementById('user2Type').textContent = counterparty.element || '안정형';
            document.getElementById('user2Traits').innerHTML =
                (counterparty.strengths || ['신중한', '배려하는']).map(s =>
                    `<span class="action-tag">${s}</span>`
                ).join('');

            const score = analysis.compatibilityScore || 75;
            document.getElementById('compatibilityScore').textContent = score + '점';
            document.getElementById('compatibilityFill').style.width = score + '%';
        }

        function renderRoadmap(actionPlan) {
            const defaultWeeks = [
                {
                    week: 'Week 1',
                    title: '자기 인식 & 목표 설정',
                    description: '현재 상황을 정확히 파악하고, 명확한 목표를 설정합니다.',
                    actions: ['일기 쓰기', '목표 구체화', '강점 파악']
                },
                {
                    week: 'Week 2',
                    title: '관계 개선 시작',
                    description: '작은 변화부터 시작합니다. 솔직한 대화를 시도해보세요.',
                    actions: ['감사 표현하기', '경청 연습', '공감 표현']
                },
                {
                    week: 'Week 3',
                    title: '습관 형성',
                    description: '긍정적인 습관을 만들어갑니다. 꾸준함이 기적을 만듭니다.',
                    actions: ['일일 루틴', '감정 일기', '자기 돌봄']
                },
                {
                    week: 'Week 4',
                    title: '성과 확인 & 다음 단계',
                    description: '지난 한 달을 돌아보고, 앞으로의 계획을 세웁니다.',
                    actions: ['성장 확인', '감사 나누기', '새 목표 설정']
                }
            ];

            const timeline = document.getElementById('roadmapTimeline');
            const weeks = actionPlan?.weeks || defaultWeeks;

            timeline.innerHTML = weeks.map(week => `
                <div class="timeline-week">
                    <div class="week-number">${week.week || week.weekNumber}</div>
                    <div class="week-title">${week.title || week.focus}</div>
                    <div class="week-description">${week.description || week.goal}</div>
                    <div class="week-actions">
                        ${(week.actions || week.tasks || []).map(action =>
                            `<span class="action-tag">${action}</span>`
                        ).join('')}
                    </div>
                </div>
            `).join('');
        }

        function animateCompatibilityBar() {
            const fill = document.getElementById('compatibilityFill');
            if (fill) {
                setTimeout(() => {
                    fill.style.width = fill.style.width;
                }, 500);
            }
        }

        function startDailyMessages() {
            window.location.href = '/daily-messages.html';
        }

        function shareResult() {
            if (navigator.share) {
                navigator.share({
                    title: '나의 기적 지수',
                    text: `내 기적 지수는 ${document.getElementById('miracleIndex').textContent}점! 당신도 확인해보세요!`,
                    url: window.location.href
                });
            } else {
                alert('공유 기능이 지원되지 않는 브라우저입니다.');
            }
        }
    </script>
</body>
</html>
