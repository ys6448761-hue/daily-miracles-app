# Context Pack (휴가 복귀 / 용량 오버 전용)

> Aurora5 팀 표준 브리핑
> 생성일: 2026-01-14
> 기준: 최근 7일 / 최근 20커밋

---

## 0) 한 줄 요약

- **이번 기간 핵심 변화**: P3 단체 견적 플로우 완성, 일정 빌더 구현, 카카오톡 링크 수정
- **지금 가장 중요한 이슈/리스크**: GA4 측정 ID 설정 대기 중

---

## 1) 변경사항 요약 (Git 기준)

### 변경 파일 TOP 10
| # | 파일 | 변경 유형 | 변경 내용 |
|---|------|----------|----------|
| 1 | `public/itinerary-builder.html` | feat | 일정 빌더 3단계 폼 + 단체 전환 |
| 2 | `routes/quoteRoutes.js` | fix | DB INSERT 필드 추가 (source, notes) |
| 3 | `.claude/AURORA_STATUS.md` | docs | P3 마감 현황 업데이트 |
| 4 | `database/run-yeosu-wish-schema.js` | feat | 여수 소원빌기 마이그레이션 스크립트 |
| 5 | `services/quotePdfService.js` | fix | PDF 한글 깨짐 수정 |
| 6 | `routes/itineraryRoutes.js` | fix | 일정 API 수정 |
| 7 | `config/planBTemplates.js` | fix | 카카오 링크 https 변경 |
| 8 | `services/solapiService.js` | fix | 카카오 채널 링크 수정 |
| 9 | `public/index.html` | feat | 일정 빌더 배너 추가 |
| 10 | `assets/characters/v3/*` | fix | 캐릭터 이미지 업데이트 |

### 주요 기능/모듈 변화 3줄 요약
1. **P3-1 단체 견적 브릿지**: 5인 이상 → 단체 견적 전환 모달 구현
2. **일정 빌더 완성**: 4인 이하 자동 일정 생성 + PDF 다운로드
3. **카카오톡 링크 일괄 수정**: http → https, /chat 경로 추가

### 신규 추가/삭제된 엔드포인트/핵심 함수
- **추가**: `POST /api/v2/quote/wix` (단체 견적 요청)
- **수정**: `POST /api/itinerary/build` (일정 생성 API)
- **삭제**: 없음

---

## 2) 기능 영향 지도 (LSP 기준)

### 핵심 진입점(Entry Points) 3개

1. **일정 빌더 API**
   - 파일: `routes/itineraryRoutes.js`
   - 역할: 일정 생성 및 PDF 반환
   - 연관 모듈: `services/itineraryService.js`, `services/quotePdfService.js`

2. **견적 API**
   - 파일: `routes/quoteRoutes.js`
   - 역할: 견적 생성/조회/승인/확정
   - 연관 모듈: `services/dealStructuringService.js`, `services/quotePdfService.js`

3. **Solapi 메시지 서비스**
   - 파일: `services/solapiService.js`
   - 역할: SMS/알림톡 발송
   - 연관 모듈: `config/messageTemplates.js`, `routes/wishRoutes.js`

### Call Hierarchy 요약 (핵심 흐름만)
```
[프론트엔드] → [Express Router] → [Service Layer] → [DB/OpenAI] → [Response/PDF]

일정 빌더 플로우:
itinerary-builder.html → /api/itinerary/build → itineraryService.buildItinerary()
  → OpenAI (일정 생성) → quotePdfService (PDF) → Response

견적 플로우:
quote.html → /api/v2/quote/wix → quoteRoutes.createQuote()
  → DB INSERT → dealStructuringService (승인 체크) → Response
```

### References로 확인된 영향 범위
- **관련 파일**: 27개 파일 변경
- **관련 함수**: `buildItinerary()`, `createQuote()`, `generateQuotePdf()`, `sendKakaoAlimtalk()`

---

## 3) 현재 리스크 & 깨지기 쉬운 구간

### 리스크 TOP 5
| 순위 | 리스크 | 심각도 | 대응 방안 |
|------|--------|--------|----------|
| 1 | GA4 측정 ID 미설정 | MED | 측정 ID 받아서 설정 필요 |
| 2 | PDF 한글 폰트 (Render) | LOW | Noto Sans KR 임베드 완료 |
| 3 | 카카오 링크 누락 가능성 | LOW | 전체 검색으로 추가 확인 필요 |
| 4 | DB 마이그레이션 누락 | MED | 프로덕션 DB 확인 필요 |
| 5 | 10회 검증 미완료 | LOW | 나중에 진행 예정 |

### "꼭 테스트해야 하는 것" 체크리스트
- [ ] 일정 빌더 4인 이하 → PDF 다운로드
- [ ] 일정 빌더 5인 이상 → 단체 견적 전환
- [ ] 카카오톡 채널 링크 정상 작동
- [ ] 견적 생성 → DB 저장 확인
- [ ] PDF 한글 정상 표시

---

## 4) 다음 해야 할 일 TOP 5 (우선순위/난이도)

| 우선순위 | 할 일 | 예상 소요 | 담당(권장) | 비고 |
|----------|-------|-----------|-----------|------|
| P0 | GA4 측정 ID 설정 | 10분 | Code | 측정 ID 필요 |
| P1 | 여수 소원빌기 DB 마이그레이션 실행 | 5분 | Code | 프로덕션 확인 |
| P1 | 10회 검증 validation 진행 | 2시간 | 재미 | 이미지 생성 필요 |
| P2 | 카카오 링크 전체 검색/확인 | 15분 | Code | 누락 없는지 확인 |
| P2 | 프로덕션 일정 빌더 테스트 | 30분 | QA | 엔드투엔드 테스트 |

---

## 5) 스코프 컷 (지금 안 봐도 되는 것)

### 이번 사이클에서 제외
- NanoBanana Visual OS 검증 (나중에 진행)
- MCP 서버 추가 개발
- Notion 연동

### 나중에 보면 됨
- 후기 수집 자동화
- 스토리북 2.0
- 마케팅 오케스트레이터

---

## 6) 실행/배포 체크 (로컬/스테이징)

### 로컬 실행
```bash
npm install
npm run dev
# 서버: http://localhost:5100
```

### 테스트
```bash
# 일정 빌더 테스트
curl http://localhost:5100/itinerary-builder.html

# 견적 API 테스트
curl -X POST http://localhost:5100/api/v2/quote/wix \
  -H "Content-Type: application/json" \
  -d '{"name":"테스트","phone":"010-1234-5678","pax":5}'
```

### 배포 전 체크
- [x] 환경변수 확인 (DATABASE_URL)
- [x] DB 마이그레이션 완료
- [x] API 엔드포인트 테스트
- [x] 프론트엔드 빌드 성공

### 배포 후 모니터링 포인트
- Render 대시보드: 서버 상태
- DB: quotes 테이블 데이터 정상 저장 확인
- 카카오: 채널 링크 정상 작동

---

## 최근 커밋 이력 (참고)

```
830c5ee fix(assets): Aurora5 캐릭터 이미지 업데이트
bfc630b chore: 카카오톡 링크 추가 수정 + 마이그레이션 스크립트 개선
52866f3 fix: 카카오톡 링크 일괄 수정
39916d3 docs: AURORA_STATUS.md 업데이트 (P3 마감)
2a37fdf fix: 전화번호 010-3819-6178로 수정
27a730a fix: 긴급 Fix 3종 - 카카오/슬라이더/PDF 한글
5ae7bb4 feat(itinerary): P3 마감 - 단체 견적 플로우 업그레이드
15aa054 docs: AURORA_STATUS.md 업데이트 (P3-1 완료)
e7aa698 fix(quote): DB INSERT에 source, notes, env 컬럼 추가
57f4e33 fix(quote): source/must_go/avoid 필드 저장 지원
```

---

*Aurora5 Visual OS v1.0 - Context Pack*
*Generated by Claude Code with LSP Integration*
*2026-01-14*
