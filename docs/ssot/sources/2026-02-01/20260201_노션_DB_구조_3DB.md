# ë…¸ì…˜ DB êµ¬ì¡° (3DB) - ìžë™í™” í•„ìˆ˜ ì†ì„±

> **IMMUTABLE SOURCE - DO NOT MODIFY**
> ì›ë¬¸ ì±„íŒ… ê·¸ëŒ€ë¡œ ë³´ì¡´ (ìˆ˜ì • ê¸ˆì§€)
> ìž‘ì„±ì¼: 2026-02-01

---

## 1) ë…¸ì…˜ DB êµ¬ì¡°(3DB)ì—ì„œ "ìžë™í™”ê°€ ë¨¹ížˆëŠ”" í•„ìˆ˜ ì†ì„±

### A. Episodes DB (10í–‰)

**í•„ìˆ˜ ì†ì„±:**
- EpisodeID (í…ìŠ¤íŠ¸, ì˜ˆ: PV11-EP01)
- PromoNo (ìˆ«ìž: 11~20)
- Title (í…ìŠ¤íŠ¸)
- LocationMode (ì…€ë ‰íŠ¸: GENERIC / YEOSU)
- Status (ì…€ë ‰íŠ¸: BACKLOG â†’ READY â†’ PRODUCING â†’ QC â†’ DONE)
- Scenes (Relation â†’ Scenes DB)
- CTA (Relation â†’ CTA DB, ë˜ëŠ” CTAë¥¼ ì—í”¼ì†Œë“œì— ì»¬ëŸ¼ìœ¼ë¡œ ë„£ì–´ë„ ë¨)
- Progress% (Rollup: Scenes ì™„ë£Œìœ¨)
- ExportPackURL (íŒŒì¼/URL: ë‚´ë³´ë‚¸ ZIP/CSV ë§í¬)

**ë·°(í•„ìˆ˜):**
- Backlog, Today, QC Needed, Done
- "ì´ ì—í”¼ì†Œë“œì˜ Scenesë§Œ" ë³´ì´ëŠ” Relation í•„í„° ë·°

### B. Scenes DB (60í–‰)

**í•„ìˆ˜ ì†ì„±:**
- SceneID (í…ìŠ¤íŠ¸: PV11-EP01-S01)
- Episode (Relation â†’ Episodes)
- SceneNo (1~6)
- StartSec, EndSec (ìˆ«ìž)
- BackgroundPreset (ì…€ë ‰íŠ¸: GN01~GN06)
- LocalDetail (ìˆ«ìž or í…ìŠ¤íŠ¸)
- Aurum_State / Aurum_Expression (ì…€ë ‰íŠ¸)
- KF_Prompt_Full (ë¦¬ì¹˜í…ìŠ¤íŠ¸)
- I2V_Prompt_Full (ë¦¬ì¹˜í…ìŠ¤íŠ¸)
- Subtitle_PostEdit (ë¦¬ì¹˜í…ìŠ¤íŠ¸)
- QCFlag (ì²´í¬ë°•ìŠ¤) + QCReason(í…ìŠ¤íŠ¸)
- Status (ì…€ë ‰íŠ¸: DRAFT â†’ PROMPT_LOCKED â†’ GEN_REQUESTED â†’ GENERATED â†’ EDITED â†’ DONE)
- OutputAsset (íŒŒì¼/URL)

**í…œí”Œë¦¿(ê°•ì¶”):**
Scene íŽ˜ì´ì§€ í…œí”Œë¦¿ì— "í”„ë¡¬í”„íŠ¸/ìžë§‰/ì²´í¬ë¦¬ìŠ¤íŠ¸/ì‚°ì¶œë¬¼ ë§í¬" ì„¹ì…˜ì„ ê³ ì •

### C. CTA DB (10í–‰)
- CTAID, Episode(Relation), OnScreen, VoiceOver, Caption, LinkText ë“±

---

## 2) "ë…¸ì…˜ ë‚´ìž¥ ìžë™í™”"ë¡œ ë°”ë¡œ ê±¸ ìˆ˜ ìžˆëŠ” 6ê°œ ìžë™í™”

### ìžë™í™” N1) Episodeê°€ READY ë˜ë©´ "6ì”¬ ìžë™ ìƒì„±"
- Trigger: Episodes DBì—ì„œ Status = READYë¡œ ë³€ê²½
- Action: Scenes DBì— íŽ˜ì´ì§€ 6ê°œ ìƒì„±
  - Episode ì—°ê²° ìžë™
  - SceneNo = 1..6
  - StartSec/EndSecëŠ” ê·œì¹™(0-5/5-10â€¦)ìœ¼ë¡œ ì±„ì›€
  - Status = DRAFT
- âœ… íš¨ê³¼: CSV importë¥¼ ë§¤ë²ˆ ì•ˆ í•´ë„ "ë²„íŠ¼ í•œ ë²ˆ"ìœ¼ë¡œ ì”¬ ì„¸íŠ¸ê°€ ìƒê¹€

### ìžë™í™” N2) LocationMode ë°”ë€Œë©´ BackgroundPreset ìžë™ ë¦¬ë§¤í•‘
- Trigger: Episodes DBì—ì„œ LocationMode = YEOSUë¡œ ë³€ê²½
- Action: (ë…¸ì…˜ ë‚´ìž¥ë§Œìœ¼ë¡œëŠ” "ì—°ê²°ëœ ëª¨ë“  Scene ì—…ë°ì´íŠ¸"ê°€ ì œí•œë  ìˆ˜ ìžˆìŒ)
  â†’ ì´ê±´ Makeë¡œ ë¹¼ëŠ” ê±¸ ì¶”ì²œ

### ìžë™í™” N3) Scene í”„ë¡¬í”„íŠ¸ í•„ìˆ˜ê°’ ëˆ„ë½ ì‹œ QCFlag ìžë™ ON
- Trigger: Scenes DBì—ì„œ KF_Prompt_Full ë˜ëŠ” I2V_Prompt_Full ìˆ˜ì •
- Condition: ë¹ˆ ê°’ì´ê±°ë‚˜, BackgroundPreset/ìžë§‰ ëˆ„ë½
- Action: QCFlag = true, Status = DRAFT, QCReason ì±„ì›€
- âœ… íš¨ê³¼: ì œìž‘ ë“¤ì–´ê°€ê¸° ì „ì— "ë¹ˆ í”„ë¡¬í”„íŠ¸" ì‚¬ê³ ë¥¼ ìžë™ ì°¨ë‹¨

### ìžë™í™” N4) Sceneì´ PROMPT_LOCKED ë˜ë©´ ì œìž‘ íë¡œ ì•Œë¦¼
- Trigger: Scenes DBì—ì„œ Status = PROMPT_LOCKED
- Action: ìš´ì˜ ì±„ë„(ì˜ˆ: Slack)ë¡œ ì•Œë¦¼ + ë‹´ë‹¹ìž ë©˜ì…˜

### ìžë™í™” N5) Sceneì— OutputAsset ë“¤ì–´ì˜¤ë©´ ìžë™ ì™„ë£Œ ì²˜ë¦¬
- Trigger: OutputAsset ì—…ë°ì´íŠ¸
- Action: Status = DONE, QCFlag = false (ì¡°ê±´ë¶€)

### ìžë™í™” N6) ë§¤ì¼ 9ì‹œ "ì–´ì œ ìž‘ì—… ìš”ì•½ ë¦¬í¬íŠ¸" ìžë™ ìƒì„±
- Trigger: ìŠ¤ì¼€ì¤„(ë§¤ì¼ 09:00, Asia/Seoul)
- Action: ë¦¬í¬íŠ¸ íŽ˜ì´ì§€ ìƒì„±("Daily Ops Report")
  - ì–´ì œ DONE ëœ Scene ìˆ˜, ë§‰ížŒ Scene(ìƒíƒœ ì •ì²´) ëª©ë¡, QCFlag ëª©ë¡
  - Episodes ì§„í–‰ë¥  TOP/LOW

---

## 3) Make/Zapierë¡œ "ì§„ì§œ ìžë™í™”" ì™„ì„±í•˜ëŠ” 4ê°œ ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ A) Episode READY â†’ 6ì”¬ ìƒì„± + GN í”„ë¦¬ì…‹ ìžë™ ì£¼ìž…
- Watch: Episodes (Status ë³€ê²½)
- Create: Scenes 6ê°œ
- Update: Sceneë³„ BackgroundPreset=GN01~GN06 ìžë™ ë°°ì¹˜(ë£° ê¸°ë°˜)

### ì‹œë‚˜ë¦¬ì˜¤ B) LocationMode=YEOSU â†’ Scenes í”„ë¦¬ì…‹ ì¼ê´„ ë¦¬ë§¤í•‘
- Watch: Episodes(LocationMode ë³€ê²½)
- Search: í•´ë‹¹ Episodeì˜ Scenes ì „ë¶€
- Update: GNxx â†’ YSxx ë§¤í•‘ ë£° ì ìš©
- "ëžœë“œë§ˆí¬ 2ì”¬+ / Anchor 1ì”¬ ê°•ì œ" ê°™ì€ ë£°ë„ ì—¬ê¸°ì„œ êµ¬í˜„

### ì‹œë‚˜ë¦¬ì˜¤ C) PROMPT_LOCKED â†’ "ì œìž‘ ì‹¤í–‰ íŒ¨í‚·" ìžë™ ë‚´ë³´ë‚´ê¸°
- Watch: Scenes(Status= PROMPT_LOCKED)
- Aggregate: Episodeë³„ ì”¬ 6ê°œë¥¼ ëª¨ì•„
- Create file: CSV/JSON(ì†Œë¼ìš©) ìƒì„± í›„
- Upload: ë“œë¼ì´ë¸Œ ì €ìž¥ + Episodesì— ExportPackURL ê¸°ë¡
- Notify: ì œìž‘ ë‹´ë‹¹ ì±„ë„ ì•Œë¦¼

### ì‹œë‚˜ë¦¬ì˜¤ D) ìƒíƒœ ì •ì²´(SLA) ê°ì§€ â†’ ì‹ í˜¸ë“± ì—ìŠ¤ì»¬ë ˆì´ì…˜
- Watch: Scenes (updated time)
- Rule:
  - 24ì‹œê°„ ì´ìƒ GEN_REQUESTED ì •ì²´ â†’ ðŸŸ¡
  - 48ì‹œê°„ ì´ìƒ + QCFlag true â†’ ðŸ”´
- Action: ì½”ë¯¸/ë‹´ë‹¹ìžì—ê²Œ ì•Œë¦¼ (ê¸´ê¸‰ì€ KakaoTalk ê°™ì€ ì¦‰ì‹œ ì±„ë„)

---

## 4) ì‹¤íŒ¨/ì—ëŸ¬ ì²˜ë¦¬(ìš´ì˜ì—ì„œ ì œì¼ ì¤‘ìš”)

- ì¤‘ë³µ ë°©ì§€: SceneIDë¥¼ í‚¤ë¡œ "Search í›„ Create"
- ìž¬ì‹œë„: Notion API 429/5xxëŠ” ì§€ìˆ˜ ë°±ì˜¤í”„(ì˜ˆ: 1m â†’ 5m â†’ 15m)
- ë¶€ë¶„ ì‹¤íŒ¨ ë³µêµ¬: 6ê°œ ì¤‘ 1ê°œ ìƒì„± ì‹¤íŒ¨ ì‹œ, ë‹¤ìŒ ì‹¤í–‰ì—ì„œ "ì—†ëŠ” ì”¬ë§Œ ìƒì„±"
- ë¡œê·¸: Make ì‹¤í–‰ ë¡œê·¸ ë§í¬ë¥¼ Episodesì— OpsLogURLë¡œ ë‚¨ê¸°ê¸°(ì„ íƒ)

---

## 5) ì½”ë¯¸ ë³´ê³  í¬ë§·(ë°”ë¡œ ê³µìœ ìš©)

ðŸ“Š [ë…¸ì…˜ ìžë™í™” ìš´ì˜ ìŠ¤íŽ™] ë³´ê³ 
- ðŸ“Œ í•µì‹¬ ë°œê²¬: Episode READYë¥¼ íŠ¸ë¦¬ê±°ë¡œ 6ì”¬ ìƒì„±/í”„ë¡¬í”„íŠ¸ ìž ê¸ˆ/íŒ¨í‚· Export/ì™„ë£Œì²˜ë¦¬/ì¼ì¼ë¦¬í¬íŠ¸ë¥¼ ìžë™í™”í•˜ë©´ ìˆ˜ë™ ìž‘ì—… 80~90% ì œê±°
- ðŸ“ˆ ë°ì´í„°: (í˜„ìž¬ ì‚°ì¶œë¬¼) 10 Episodes Ã— 6 Scenes = 60 Scenes êµ¬ì¡° ê³ ì • â†’ ìžë™í™” ë£° ê¸°ë°˜ ìš´ì˜ì— ìµœì 
- ðŸŽ¯ ì•¡ì…˜ ì œì•ˆ:
  - ì½”ë¯¸: Notion DB ì†ì„± í™•ì •(ìœ„ ë¦¬ìŠ¤íŠ¸ ê·¸ëŒ€ë¡œ)
  - ë£¨ë¯¸: Make ì‹œë‚˜ë¦¬ì˜¤ M1~M4 ì„¤ê³„ì„œ/ëª¨ë“ˆ ëª©ë¡ í™•ì •(ë©±ë“±/ìž¬ì‹œë„ í¬í•¨)
- âš ï¸ ë¦¬ìŠ¤í¬: SceneID ë©±ë“±í‚¤ ë¯¸ì ìš© ì‹œ ì¤‘ë³µ ìƒì„±/ì¤‘ë³µ Export ë°œìƒ ê°€ëŠ¥ â†’ Search-then-Create í•„ìˆ˜

---

## 6) TypeScript ì˜ˆì‹œ ìŠ¤ë‹ˆíŽ« (READY â†’ 6ì”¬ ìƒì„±)

```typescript
import { Client } from "@notionhq/client";

const notion = new Client({ auth: process.env.NOTION_TOKEN });

type Episode = { id: string; episodeId: string };
type Scene = { sceneId: string; sceneNo: number };

const SCENES_DB = process.env.NOTION_SCENES_DB_ID!;
const EPISODES_DB = process.env.NOTION_EPISODES_DB_ID!;

function sceneId(episodeId: string, i: number) {
  return `${episodeId}-S${String(i).padStart(2, "0")}`;
}

function presetGN(i: number) {
  return `GN${String(i).padStart(2, "0")}`; // 1->GN01
}

async function listScenesByEpisodeId(episodeId: string): Promise<Scene[]> {
  const res = await notion.databases.query({
    database_id: SCENES_DB,
    filter: {
      property: "EpisodeID",
      rich_text: { equals: episodeId },
    },
  });

  return res.results.map((r: any) => ({
    sceneId: r.properties.SceneID.rich_text?.[0]?.plain_text ?? "",
    sceneNo: r.properties.SceneNo.number ?? 0,
  }));
}

async function createScene(episode: Episode, i: number) {
  const sid = sceneId(episode.episodeId, i);
  const start = (i - 1) * 5;
  const end = i * 5;

  await notion.pages.create({
    parent: { database_id: SCENES_DB },
    properties: {
      SceneID: { rich_text: [{ text: { content: sid } }] },
      Episode: { relation: [{ id: episode.id }] },
      EpisodeID: { rich_text: [{ text: { content: episode.episodeId } }] },
      SceneNo: { number: i },
      StartSec: { number: start },
      EndSec: { number: end },
      BackgroundPreset: { select: { name: presetGN(i) } },
      Status: { select: { name: "DRAFT" } },
    },
  });
}

export async function handleEpisodeReady(episode: Episode) {
  const existing = await listScenesByEpisodeId(episode.episodeId);
  const existingIds = new Set(existing.map(s => s.sceneId));

  for (let i = 1; i <= 6; i++) {
    const sid = sceneId(episode.episodeId, i);
    if (existingIds.has(sid)) continue; // âœ… ë©±ë“±ì„±: ì¤‘ë³µ ìƒì„± ë°©ì§€
    await createScene(episode, i);
  }
}
```

í•µì‹¬ í¬ì¸íŠ¸ëŠ” "ë¨¼ì € ì¡°íšŒ â†’ ì—†ëŠ” ê²ƒë§Œ ìƒì„±" ì´ í•œ ì¤„ ì² í•™ìž…ë‹ˆë‹¤.
