# 소원놀이터 (Wish Playground) 종합 문서

> **버전**: v1.0
> **기준일**: 2026-02-08
> **출처**: `services/playground/*`, `routes/playgroundRoutes.js`, `database/migrate-014-playground.js`

---

## 1. 개요

소원놀이터는 사용자들이 소원과 일상을 공유하고 서로 응원하는 UGC(User Generated Content) 플랫폼입니다.

### 핵심 철학

| 원칙 | 설명 |
|------|------|
| **도움 중심** | 조회수가 아닌 '도움 점수' 기반 추천 |
| **압박 없음** | "반드시 성공해야"와 같은 압박 표현 감점 |
| **비낙인** | 자기비하/타인비하 표현 배제 |
| **현실 단서** | 구체적인 현실 기반 계획 포함 |

---

## 2. 철학점수 (Philosophy Score)

### 2.1 점수 구성 (총 100점)

| 항목 | 코드 | 점수 | 필수 | 설명 |
|------|------|------|------|------|
| 압박0 | `pressure_zero` | 20점 | - | 압박/강요 표현 없음 |
| 존중/비낙인 | `respect` | 15점 | - | 자기비하/타인비하 없음 |
| 고통정화 | `pain_purify` | 10점 | - | 고통 표현은 허용, 유해 표현만 감점 |
| 현실단서 | `reality_hint` | 15점 | **필수** | 구체적 현실 기반 계획 |
| 한걸음 | `one_step` | 20점 | **필수** | 오늘 할 수 있는 작은 행동 |
| 축복 한 줄 | `blessing` | 20점 | **필수** | 타인을 위한 응원 메시지 |

### 2.2 등급 기준

| 등급 | 점수 | 노출 권한 |
|------|------|----------|
| **S** | 90점 이상 | 피드 + 하이라이트 + 공유 + 모든 기능 |
| **A** | 75~89점 | 피드 추천 + 공유 |
| **B** | 60~74점 | 기본 피드 노출 + 공유 |
| **C** | 40~59점 | 링크 공유만 (피드 제외) |
| **D** | 40점 미만 | 비공개 전용 (재작성 권장) |

### 2.3 감점 패턴

**압박 표현 (각 -5점)**
```
반드시 해야 / 무조건 성공 / 실패하면 안 / 꼭 해야만 / 100% 보장
```

**낙인 표현 (각 -5점)**
```
게으른 / 무능한 / 찐따 / 루저 / 패배자 / 실패자
```

### 2.4 하드블록 (즉시 차단)

다음 콘텐츠는 자동 차단되며 D등급 처리됩니다:

| 카테고리 | 예시 패턴 |
|----------|----------|
| 자해/자살 | 자살 방법, 목숨 끊, 죽고 싶 |
| 폭력/협박 | 죽여 버리, 때려 패, 칼로 찌 |
| 혐오 표현 | 한남/한녀, 틀딱, 맘충, 재기 |
| 불법 | 마약 구매, 대포통장, 보이스피싱 |

---

## 3. 피드 시스템

### 3.1 랭킹 공식

```
rank_score = 0.55 × score_total + 0.35 × help_score + 0.10 × freshness
```

| 요소 | 가중치 | 설명 |
|------|--------|------|
| 철학점수 | 55% | 콘텐츠 품질 |
| 도움점수 | 35% | 커뮤니티 반응 |
| 신선도 | 10% | 최근 작성 가점 |

### 3.2 피드 유형

| 피드 | 설명 | 최소 등급 |
|------|------|----------|
| **메인 피드** | 랭킹순 정렬 | B 이상 |
| **하이라이트** | S/A 등급 + 높은 help_score | S, A |
| **최신순** | 시간순 정렬 | B 이상 |
| **태그별** | reality_tag 필터링 | B 이상 |
| **리믹스 인기** | 리믹스 많이 된 원본 | S, A, B |

### 3.3 도움점수 (Help Score)

사용자 반응 기반 점수:

| 반응 | 코드 | 점수 기여 |
|------|------|----------|
| 따뜻해요 | `warm` | +1 |
| 고마워요 | `thanks` | +2 |
| 저장했어요 | `saved` | +3 |
| 응원해요 | `cheer` | +1 |

---

## 4. 보상 시스템

### 4.1 배지 (6종)

| 배지 | 이름 | 획득 조건 |
|------|------|----------|
| `first_artifact` | 첫 발자국 | 첫 번째 창작물 생성 |
| `warm_one_liner` | 따뜻한 한 줄러 | S/A등급 + 따뜻한 반응 5회 |
| `healed_someone` | 누군가를 치유한 사람 | saved/thanks 반응 10회 |
| `remix_spark` | 리믹스 불꽃 | 내 작품 리믹스 3회 |
| `bring_a_creator` | 창작자 초대장 | 공유 링크로 새 창작자 유입 |
| `s_grade_master` | S등급 마스터 | S등급 창작물 5개 |

### 4.2 크레딧 (5종)

| 크레딧 | 금액 | 조건 |
|--------|------|------|
| `artifact_s_grade` | 50점 | S등급 창작물 생성 |
| `artifact_a_grade` | 20점 | A등급 창작물 생성 |
| `weekly_s_grade` | 100점 | 주간 S등급 획득 |
| `first_creator_via_link` | 200점 | 공유 링크로 첫 창작자 |
| `top_help_score_weekly` | 300점 | 주간 도움점수 상위 3명 |

---

## 5. 아티팩트 (창작물)

### 5.1 유형

| 유형 | 코드 | 설명 |
|------|------|------|
| 소원카드 | `wish_card` | 소원 + 현실계획 |
| 일일퀘스트 | `daily_quest` | 오늘 할 일 공유 |
| 리믹스북 | `remix_storybook` | 다른 창작물 재해석 |

### 5.2 필수 필드

```json
{
  "heart_line": "진심을 담은 한 줄",
  "reality_hint": "현실 계획 설명",
  "reality_tag": "카테고리 태그",
  "one_step": "오늘 할 작은 행동",
  "blessing_line": "타인을 위한 응원"
}
```

### 5.3 리믹스 구조

```
root_id      → 최상위 원본 ID
parent_id    → 직접 부모 ID
remix_depth  → 리믹스 깊이 (0 = 원본)
```

---

## 6. 공유 시스템

### 6.1 공유 링크

- 고유 share_code 생성
- 만료일 설정 가능
- 조회수 추적

### 6.2 추적 데이터

| 항목 | 설명 |
|------|------|
| 조회자 ID | 로그인 시 기록 |
| 조회 시각 | UTC 타임스탬프 |
| 신규 창작 여부 | 공유 통해 창작물 생성 시 기록 |

---

## 7. 이벤트 스키마

| 이벤트 | 설명 | 페이로드 |
|--------|------|----------|
| `artifact.created` | 창작물 생성 | artifact_id, user_id, type |
| `artifact.scored` | 점수 계산 완료 | artifact_id, score, grade |
| `reaction.added` | 반응 추가 | artifact_id, reaction_type |
| `badge.earned` | 배지 획득 | user_id, badge_key |
| `credit.granted` | 크레딧 지급 | user_id, credit_key, amount |
| `share.created` | 공유 생성 | share_id, artifact_id |
| `share.viewed` | 공유 조회 | share_id, viewer_id |
| `remix.created` | 리믹스 생성 | artifact_id, parent_id |

---

## 8. API 엔드포인트

### 8.1 아티팩트

| 메서드 | 경로 | 설명 |
|--------|------|------|
| `POST` | `/api/playground/artifacts` | 창작물 생성 |
| `GET` | `/api/playground/artifacts/:id` | 창작물 조회 |
| `PUT` | `/api/playground/artifacts/:id` | 창작물 수정 |
| `DELETE` | `/api/playground/artifacts/:id` | 창작물 삭제 |
| `GET` | `/api/playground/artifacts/:id/score` | 점수 조회 |
| `GET` | `/api/playground/artifacts/:id/history` | 점수 이력 |

### 8.2 피드

| 메서드 | 경로 | 설명 |
|--------|------|------|
| `GET` | `/api/playground/feed` | 메인 피드 |
| `GET` | `/api/playground/feed/highlights` | 하이라이트 |
| `GET` | `/api/playground/feed/recent` | 최신순 |
| `GET` | `/api/playground/feed/popular-remix` | 리믹스 인기 |

### 8.3 반응

| 메서드 | 경로 | 설명 |
|--------|------|------|
| `POST` | `/api/playground/artifacts/:id/reactions` | 반응 추가 |
| `GET` | `/api/playground/artifacts/:id/reactions` | 반응 조회 |
| `DELETE` | `/api/playground/reactions/:id` | 반응 삭제 |

### 8.4 공유

| 메서드 | 경로 | 설명 |
|--------|------|------|
| `POST` | `/api/playground/shares` | 공유 생성 |
| `GET` | `/api/playground/shares/:code` | 공유 조회 |
| `POST` | `/api/playground/shares/:code/view` | 조회 기록 |

### 8.5 사용자

| 메서드 | 경로 | 설명 |
|--------|------|------|
| `GET` | `/api/playground/users/:id` | 사용자 정보 |
| `GET` | `/api/playground/users/:id/artifacts` | 사용자 창작물 |
| `GET` | `/api/playground/users/:id/rewards` | 보상 현황 |
| `GET` | `/api/playground/users/:id/badges` | 배지 목록 |

---

## 9. 데이터베이스 스키마

### 9.1 테이블 목록 (10개)

| 테이블 | 용도 |
|--------|------|
| `playground_users` | 사용자 프로필 + 크레딧 |
| `artifacts` | 창작물 본체 |
| `artifact_scores` | 철학점수 + 등급 |
| `artifact_help_scores` | 도움점수 집계 |
| `artifact_reactions` | 개별 반응 |
| `shares` | 공유 링크 |
| `share_views` | 공유 조회 기록 |
| `user_badges` | 획득 배지 |
| `rewards` | 보상 로그 |
| `playground_events` | 이벤트 로그 |

### 9.2 핵심 테이블 상세

**artifacts**
```sql
artifact_id     UUID PRIMARY KEY
user_id         VARCHAR(64) NOT NULL
type            VARCHAR(32) NOT NULL  -- wish_card, daily_quest, remix_storybook
content_json    JSONB NOT NULL
tags_json       JSONB
parent_id       UUID (리믹스 부모)
root_id         UUID (리믹스 최상위)
remix_depth     INTEGER DEFAULT 0
visibility      VARCHAR(16) DEFAULT 'public'
status          VARCHAR(16) DEFAULT 'active'
created_at      TIMESTAMPTZ
updated_at      TIMESTAMPTZ
```

**artifact_scores**
```sql
artifact_id     UUID PRIMARY KEY
score_total     INTEGER
grade           CHAR(1)  -- S, A, B, C, D
score_breakdown JSONB
gate_result     VARCHAR(16)  -- pass, transform, block
reasons         JSONB
computed_at     TIMESTAMPTZ
```

---

## 10. 서비스 아키텍처

```
services/playground/
├── index.js           # 메인 진입점
├── artifactService.js # 창작물 CRUD
├── scoreService.js    # 철학점수 계산
├── feedService.js     # 피드/추천
├── rewardService.js   # 배지/크레딧
├── shareService.js    # 공유 링크
└── templateService.js # 창작 템플릿
```

### 서비스 관계도

```
artifactService
    ↓ (생성 시)
scoreService → 점수 계산 → rewardService (배지/크레딧 지급)
    ↓                              ↓
feedService ← 피드 노출 조건    playground_events (로그)
    ↓
shareService → 공유 링크 생성
```

---

## 11. 사용자 플로우

### 11.1 창작 → 점수 → 노출

```
1. 사용자가 창작물 작성
2. 필수 필드 검증 (heart_line, reality_hint, one_step, blessing_line)
3. 하드블록 체크 (유해 콘텐츠 → 차단)
4. 철학점수 계산 (6개 항목, 100점 만점)
5. 등급 결정 (S/A/B/C/D)
6. 노출 권한 결정
7. B등급 이상 → 피드 노출
8. 등급별 크레딧 지급 (S: 50점, A: 20점)
9. 배지 조건 체크 → 자동 지급
```

### 11.2 리믹스 플로우

```
1. 기존 창작물 선택
2. "리믹스" 클릭
3. parent_id = 원본 ID
4. root_id = 원본의 root_id (없으면 원본 ID)
5. remix_depth = 원본 + 1
6. 새로운 창작물로 점수 계산
```

### 11.3 공유 플로우

```
1. C등급 이상 → 공유 가능
2. 고유 share_code 생성
3. 링크 공유
4. 조회 시 share_views 기록
5. 조회자가 창작물 생성 → bring_a_creator 배지
```

---

## 12. 운영 가이드

### 12.1 콘텐츠 모더레이션

| 상황 | 자동 처리 |
|------|----------|
| 하드블록 키워드 | 즉시 차단 (D등급) |
| 압박/낙인 표현 | 감점 + transform 플래그 |
| 필수 필드 누락 | 낮은 점수 처리 |

### 12.2 주간 운영 작업

1. **주간 Top Help Score** - 상위 3명 크레딧 지급 (300점)
2. **피드 통계 확인** - 등급별 분포 모니터링
3. **배지 지급 확인** - 자동 지급 로그 검토

### 12.3 모니터링 포인트

| 지표 | 정상 범위 |
|------|----------|
| S등급 비율 | 5~10% |
| A등급 비율 | 15~25% |
| B등급 비율 | 40~50% |
| 하드블록 비율 | < 1% |

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| v1.0 | 2026-02-08 | 초안 작성 |

---

*출처 파일:*
- `services/playground/scoreService.js`
- `services/playground/feedService.js`
- `services/playground/rewardService.js`
- `routes/playgroundRoutes.js`
- `database/migrate-014-playground.js`
- `.claude/team-memory/entries/2026/2026-02-06_playground-engine.md`
