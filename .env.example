# ═══════════════════════════════════════════════════════════
# Daily Miracles MVP - Environment Variables
# ═══════════════════════════════════════════════════════════

# ─────────────────────────────────────────────────────────────
# 서버 설정 (Server Configuration)
# ─────────────────────────────────────────────────────────────
NODE_ENV=development          # development | staging | production
PORT=5100                     # Render는 자동 할당, 로컬은 5100 사용

# ─────────────────────────────────────────────────────────────
# 릴리즈 게이트 (Open Gate)
# ─────────────────────────────────────────────────────────────
APP_DISABLED=false            # true → 503 점검 모드
OUTBOUND_ENABLED=false        # true → 실발송 허용 (SMS/알림톡)
PLAZA_ENABLED=false           # true → /plaza 페이지 활성화

# ─────────────────────────────────────────────────────────────
# 앱 기본 URL (필수 - App Base URL)
# ─────────────────────────────────────────────────────────────
# 결제 콜백, 알림톡 링크 등에 사용되는 기본 도메인
APP_BASE_URL=https://app.dailymiracles.kr

# ─────────────────────────────────────────────────────────────
# CORS 설정 (필수 - CORS Configuration)
# ─────────────────────────────────────────────────────────────
# 쉼표로 구분하여 허용할 도메인 추가
# 프로덕션 권장값:
ALLOWED_ORIGINS=https://dailymiracles.kr,https://www.dailymiracles.kr,https://app.dailymiracles.kr

# ─────────────────────────────────────────────────────────────
# OpenAI API (필수 - Required)
# ─────────────────────────────────────────────────────────────
# https://platform.openai.com/api-keys 에서 발급
OPENAI_API_KEY=sk-proj-your-openai-api-key-here

# ─────────────────────────────────────────────────────────────
# 로깅 설정 (Logging)
# ─────────────────────────────────────────────────────────────
REQUEST_LOG=1                 # 1=활성화, 0=비활성화 (프로덕션은 0 권장)

# ─────────────────────────────────────────────────────────────
# 데이터베이스 (선택 - Optional Database)
# ─────────────────────────────────────────────────────────────
# PostgreSQL 사용 시에만 설정
# DATABASE_URL=postgresql://user:password@host:5432/database

# ─────────────────────────────────────────────────────────────
# SENS (네이버 클라우드 - 알림톡/SMS) ⭐ 현재 사용 중
# ─────────────────────────────────────────────────────────────
# https://console.ncloud.com/sens 에서 서비스 생성 후 설정
#
# [설정 순서]
# 1. NCP 콘솔 > IAM > 서브 계정 > API 키 발급
# 2. SENS > 알림톡 서비스 생성 > 서비스 ID 확인
# 3. SENS > SMS 서비스 생성 > 서비스 ID 확인 (failover용)
# 4. 카카오 채널 연동 (@dailymiracles)
# 5. 알림톡 템플릿 등록 및 승인

# 필수 설정
SENS_ACCESS_KEY=your-ncp-access-key          # NCP IAM 액세스 키
SENS_SECRET_KEY=your-ncp-secret-key          # NCP IAM 시크릿 키
SENS_SERVICE_ID=ncp:kkobizmsg:kr:xxxxx       # 알림톡 서비스 ID
SENS_SMS_SERVICE_ID=ncp:sms:kr:xxxxx         # SMS 서비스 ID (알림톡 실패 시 failover)
SENS_CHANNEL_ID=_xfxhcWn                     # 카카오 채널 ID (@dailymiracles)

# 알림톡 템플릿 코드 (카카오 승인 후 입력)
SENS_TEMPLATE_CODE=                          # 기적 결과 알림톡 템플릿
SENS_ACK_TEMPLATE_CODE=betawelcome           # 소원 접수 ACK 알림톡 템플릿 (웰컴)
SENS_QUOTE_TEMPLATE_CODE=                    # 견적 접수 알림톡 템플릿
SENS_MORNING_TEMPLATE_CODE=                  # 아침 응원 메시지 템플릿
SENS_EVENING_TEMPLATE_CODE=                  # 저녁 응원 메시지 템플릿

# 발신번호 설정
SENDER_PHONE=18996117                        # 알림톡/SMS 발신번호

# 기능 플래그
MSG_USE_SENS=true                            # SENS 사용 여부 (기본: true)

# ─────────────────────────────────────────────────────────────
# [레거시] Solapi (사용 안 함 - 참고용)
# ─────────────────────────────────────────────────────────────
# SOLAPI_API_KEY=
# SOLAPI_API_SECRET=
# SOLAPI_PFID=

# ─────────────────────────────────────────────────────────────
# 긴급 알림 수신자
# ─────────────────────────────────────────────────────────────
CRO_PHONE=01012345678                        # 재미(CRO) - RED 신호 알림
EMERGENCY_ALERT_PHONE=01012345678            # 시스템 장애 알림

# ─────────────────────────────────────────────────────────────
# Airtable (관제탑 ACT)
# ─────────────────────────────────────────────────────────────
# https://airtable.com/create/tokens 에서 Personal Access Token 발급
AIRTABLE_API_KEY=pat.xxxxxxxxxxxx
AIRTABLE_BASE_ID=appXXXXXXXXXXXXXX

# 테이블명 (기본값 사용 시 생략 가능)
# AIRTABLE_TABLE_DAILY_HEALTH=Daily Health
# AIRTABLE_TABLE_ALERTS=Alerts

# ─────────────────────────────────────────────────────────────
# 알림 수신자 (Alert Recipients)
# ─────────────────────────────────────────────────────────────
COO_PHONE=01012345678                        # 코미(COO) - 모든 알림 수신
CEO_PHONE=01012345678                        # 푸르미르(CEO) - RED 알림만
QUALITY_PHONE=01012345678                    # 여의보주 - RED 알림만

# ─────────────────────────────────────────────────────────────
# 선택 사항 (Optional)
# ─────────────────────────────────────────────────────────────
# ORCHESTRATOR_ENABLED=false
# OPENAI_API_BASE=https://api.openai.com
# REQUEST_TIMEOUT=30000
# MAX_RETRIES=3

# ═══════════════════════════════════════════════════════════
# Ops Center (여수 운영 컨트롤타워)
# ═══════════════════════════════════════════════════════════

# ─────────────────────────────────────────────────────────────
# [필수 - 운영] 관리자 보안 토큰
# ─────────────────────────────────────────────────────────────
# 🔐 운영 환경에서는 반드시 설정 (32자 이상 랜덤 권장)
# /api/ops-center/rules/reload 보호용
ADMIN_TOKEN=CHANGE_ME_TO_RANDOM_SECRET_32CHARS

# ─────────────────────────────────────────────────────────────
# [개발/데모용] 폴백 토큰
# ─────────────────────────────────────────────────────────────
# ⚠️ 개발/데모 전용 - 운영에서는 ADMIN_TOKEN만 사용 권장
DEMO_RESET_TOKEN=demo-reset-token

# ─────────────────────────────────────────────────────────────
# [운영 안전] 룰 로딩 정책
# ─────────────────────────────────────────────────────────────
# true 권장 (운영) - rules preload 실패 시 서버 즉시 종료
# production 환경에서는 자동으로 true 적용
FAIL_FAST_RULES=true

# ─────────────────────────────────────────────────────────────
# [필수 - 프로덕션] Slack 운영 알림 Webhook
# ─────────────────────────────────────────────────────────────
# 미설정 시 프로덕션 배포 차단됨 (process.exit(1))
# Heartbeat, 운영 리포트, 비상 알림에 사용
# Slack App → Incoming Webhooks → #ops-alerts 채널
OPS_SLACK_WEBHOOK=https://hooks.slack.com/services/TXXXX/BXXXX/xxxxxxxx
# SLACK_WEBHOOK_URL은 OPS_SLACK_WEBHOOK의 별칭 (둘 중 하나만 설정해도 됨)
# SLACK_WEBHOOK_URL=https://hooks.slack.com/services/xxx

# ═══════════════════════════════════════════════════════════
# SkillsMP (14만 5천+ 스킬 마켓플레이스) - 기본 OFF
# ═══════════════════════════════════════════════════════════
# 토큰/비용 폭탄 위험으로 기본 비활성화
# 프로덕션(NODE_ENV=production)에서는 활성화 불가

# 명시적으로 true 설정 시에만 MCP 서버 실행
SKILLSMP_ENABLED=false

# https://skillsmp.com 에서 API 키 발급
# SKILLSMP_API_KEY=sk_live_skillsmp_your_key_here

# 검색 결과 최대 개수 (비용 제어)
SKILLSMP_MAX_RESULTS=10

# 컨텍스트 주입 토큰 상한 (긴 텍스트 주입 차단)
SKILLSMP_MAX_CONTEXT_TOKENS=1500
