#!/bin/sh
#
# Pre-commit hook: docs ë³€ê²½ ì‹œ manifest.json ìë™ ê°±ì‹ 
# ë£¨ë¯¸ ê·œì¹™ v1.0 ê¸°ë°˜
#

# ìƒ‰ìƒ ì •ì˜
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# docs/ í´ë” ë³€ê²½ í™•ì¸ (index ì œì™¸)
DOCS_CHANGED=$(git diff --cached --name-only | grep -E "^docs/" | grep -v "^docs/index/" | grep -v "^docs/raw/" | head -1)

if [ -n "$DOCS_CHANGED" ]; then
    echo "${YELLOW}ğŸ“„ docs/ ë³€ê²½ ê°ì§€ - manifest ìë™ ê°±ì‹  ì¤‘...${NC}"

    # manifest ìƒì„± ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
    node scripts/generate-manifest.js > /dev/null 2>&1

    if [ $? -eq 0 ]; then
        # ìƒì„±ëœ íŒŒì¼ì„ stagingì— ì¶”ê°€
        git add docs/index/manifest.json docs/index/tags.json 2>/dev/null

        echo "${GREEN}âœ… manifest.json & tags.json ìë™ ê°±ì‹  ì™„ë£Œ${NC}"
    else
        echo "${YELLOW}âš ï¸ manifest ìƒì„± ì‹¤íŒ¨ - ì»¤ë°‹ì€ ê³„ì† ì§„í–‰${NC}"
    fi
fi

exit 0
